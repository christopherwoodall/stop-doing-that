---
name: 🩻 Utilizing GitHub Actions for Temporary Infrastructure


on:
  workflow_dispatch:
    target-host:
      description: 'The host to ping'
      required: true
      default: 'google.com'


# Limit workflow to one job per branch.
concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.sha }}
  cancel-in-progress: true


jobs:
  nmap-scan:
    name: 🛥️ Port Scan
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: 📩 Checkout the source w/ full depth(for tags and SCM)
        uses: actions/checkout@v3
        with:
          fetch-depth: 0


      - name: 📦 Setup the Environment
        run: |
          mkdir /tmp/artifacts
          sudo apt update
          sudo apt install --yes netcat


      - name: 🧱 Run the Scan
        run: |
          # nc -z -v subversion.apache.org 443 > /tmp/artifacts/port-scan.txt
          ping -c 5 ${{ github.event.target-host }} > /tmp/artifacts/ping.txt


      - name: 📁 Archiving Artifacts
        uses: actions/upload-artifact@v3
        if: ${{ !failure() }}
        continue-on-error: true
        with:
          name: scan-artifacts
          retention-days: 1
          path: |
            /tmp/artifacts
